# ุฅุตูุงุญ ูุดููุฉ ุชุฌููุฏ ุงูุจุฑูุงูุฌ ูู ุตูุญุงุช ุงูุฅุนุฏุงุฏุงุช
**ุงูุชุงุฑูุฎ:** 2026-01-20  
**ุงููุดููุฉ:** ุชุฌููุฏ ุงูุจุฑูุงูุฌ ุนูุฏ ูุชุญ ุตูุญุชู "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู" ู"ุจูุงูุงุช ุงูุดุฑูุฉ"

## ๐ ุชุญููู ุงููุดููุฉ

### ุงูุณุจุจ ุงูุฑุฆูุณู
ูุงู ุงูุจุฑูุงูุฌ ููุชุธุฑ ุงุชุตุงู MongoDB ููุฏุฉ ุชุตู ุฅูู **5 ุซูุงูู** (10 ร 0.5 ุซุงููุฉ) ูู ูู ูุฑุฉ ูุชู ูููุง:
1. ุชุญููู ุงููุณุชุฎุฏููู (`load_users`)
2. ุชุญููู ุจูุงูุงุช ุงูุดุฑูุฉ (`load_settings_data`)
3. ุชุญููู ุงูุนููุงุช (`load_currencies`)
4. ุชุญููู ุงูุญุณุงุจุงุช ุงูุงูุชุฑุงุถูุฉ (`load_default_accounts`)

### ุงูููุฏ ุงููุณุจุจ ูููุดููุฉ
```python
# ูู core/repository.py - ุฏุงูุฉ get_all_users
import time
wait_count = 0
while self._mongo_connecting and wait_count < 10:
    time.sleep(0.5)  # โ๏ธ ุงูุชุธุงุฑ 0.5 ุซุงููุฉ ร 10 = 5 ุซูุงูู!
    wait_count += 1
```

## โ ุงูุญููู ุงููุทุจูุฉ

### 1. ุฅุฒุงูุฉ ุงูุงูุชุธุงุฑ ูู `get_all_users`
**ุงูููู:** `core/repository.py`

```python
# โ ูุจู ุงูุฅุตูุงุญ
while self._mongo_connecting and wait_count < 10:
    time.sleep(0.5)
    wait_count += 1

# โ ุจุนุฏ ุงูุฅุตูุงุญ
# ุชุฎุทู ุงูุงูุชุธุงุฑ - ุงุณุชุฎุฏุงู SQLite ูุจุงุดุฑุฉ ุฅุฐุง ูุงู MongoDB ุบูุฑ ูุชุตู
if self.online and self.mongo_db is not None and not self._mongo_connecting:
```

**ุงููุชูุฌุฉ:** ุชุญููู ููุฑู ูู SQLite ุจุฏูู ุงูุชุธุงุฑ MongoDB

### 2. ุชุญููู ุงูุจูุงูุงุช ุนูุฏ ุงูุทูุจ ููุท (Lazy Loading)
**ุงูููู:** `ui/settings_tab.py`

#### ุงูุชุบููุฑุงุช:
- ุฅุฒุงูุฉ `self.load_currencies()` ูู `setup_currency_tab()`
- ุฅุฒุงูุฉ `self.load_default_accounts()` ูู `setup_default_accounts_tab()`
- ุฅุถุงูุฉ ุชุญููู ุฐูู ูู `_on_sub_tab_changed()`

```python
def _on_sub_tab_changed(self, index):
    """ุชุญููู ุงูุจูุงูุงุช ููุท ุนูุฏ ูุชุญ ุงูุชุงุจ ุงููุฑุนู"""
    tab_text = self.tabs.tabText(index)
    
    # โก ุชุญููู ููุท ุฅุฐุง ูุงู ุงูุฌุฏูู ูุงุฑุบุงู (ุชุฌูุจ ุงูุชุญููู ุงููุชูุฑุฑ)
    if "ุงููุณุชุฎุฏููู" in tab_text:
        if self.users_table.rowCount() == 0:
            self.load_users()
    elif "ุงูุนููุงุช" in tab_text:
        if self.currencies_table.rowCount() == 0:
            self.load_currencies()
    # ... ุฅูุฎ
```

**ุงููุชูุฌุฉ:** 
- ูุง ูุชู ุชุญููู ุงูุจูุงูุงุช ุนูุฏ ุฅูุดุงุก ุงูุชุงุจ
- ูุชู ุงูุชุญููู ููุท ุนูุฏ ูุชุญ ุงูุชุงุจ ุงููุฑุนู
- ูุง ูุชู ุฅุนุงุฏุฉ ุงูุชุญููู ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช ููุฌูุฏุฉ ุจุงููุนู

### 3. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุฃูุถู
**ุงูููู:** `ui/main_window.py`

```python
# โ ุฅุถุงูุฉ try-catch ููู ุนูููุฉ ุชุญููู
try:
    self.settings_tab.load_settings_data()
except Exception as e:
    safe_print(f"WARNING: ูุดู ุชุญููู ุจูุงูุงุช ุงูุดุฑูุฉ: {e}")

try:
    self.settings_tab.load_users()
except Exception as e:
    safe_print(f"WARNING: ูุดู ุชุญููู ุงููุณุชุฎุฏููู: {e}")
```

**ุงููุชูุฌุฉ:** ุฅุฐุง ูุดู ุชุญููู ุฌุฒุกุ ูุง ูุชููู ุงูุจุฑูุงูุฌ ุจุงููุงูู

## ๐ ุงููุชุงุฆุฌ

### ูุจู ุงูุฅุตูุงุญ
- โฑ๏ธ ููุช ูุชุญ ุตูุญุฉ ุงููุณุชุฎุฏููู: **5-10 ุซูุงูู**
- โฑ๏ธ ููุช ูุชุญ ุตูุญุฉ ุจูุงูุงุช ุงูุดุฑูุฉ: **5-10 ุซูุงูู**
- ๐ ุงูุจุฑูุงูุฌ ูุชุฌูุฏ ุฃุซูุงุก ุงูุงูุชุธุงุฑ
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุฆุฉ

### ุจุนุฏ ุงูุฅุตูุงุญ
- โก ููุช ูุชุญ ุตูุญุฉ ุงููุณุชุฎุฏููู: **< 0.5 ุซุงููุฉ**
- โก ููุช ูุชุญ ุตูุญุฉ ุจูุงูุงุช ุงูุดุฑูุฉ: **< 0.5 ุซุงููุฉ**
- โ ุงูุจุฑูุงูุฌ ูุณุชุฌูุจ ููุฑุงู
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ

## ๐ฏ ุงููููุงุช ุงููุนุฏูุฉ

1. **core/repository.py**
   - ุฏุงูุฉ `get_all_users()` - ุฅุฒุงูุฉ ุงูุงูุชุธุงุฑ

2. **ui/settings_tab.py**
   - ุฏุงูุฉ `setup_currency_tab()` - ุฅุฒุงูุฉ ุงูุชุญููู ุงูุชููุงุฆู
   - ุฏุงูุฉ `setup_default_accounts_tab()` - ุฅุฒุงูุฉ ุงูุชุญููู ุงูุชููุงุฆู
   - ุฏุงูุฉ `_on_sub_tab_changed()` - ุฅุถุงูุฉ ุชุญููู ุฐูู
   - ุฏุงูุฉ `load_users()` - ุชุญุฏูุซ ุงูุชุนูููุงุช

3. **ui/main_window.py**
   - ุฏุงูุฉ `_do_load_tab_data_safe()` - ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฃุฎุทุงุก

## ๐ ุงูุชูุงูู

- โ ูุนูู ูุน SQLite (ูุถุน offline)
- โ ูุนูู ูุน MongoDB (ูุถุน online)
- โ ูุง ูุคุซุฑ ุนูู ุงููุฒุงููุฉ
- โ ูุง ูุคุซุฑ ุนูู ุจุงูู ุงููุธุงุฆู

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:
1. ุชุดุบูู ุงูุจุฑูุงูุฌ
2. ุชุณุฌูู ุงูุฏุฎูู
3. ูุชุญ ุชุงุจ "ุงูุฅุนุฏุงุฏุงุช"
4. ุงูุชููู ุจูู ุงูุชุงุจุงุช ุงููุฑุนูุฉ:
   - ุจูุงูุงุช ุงูุดุฑูุฉ โ
   - ุฅุฏุงุฑุฉ ุงูุนููุงุช โ
   - ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู โ
   - ุงูุญุณุงุจุงุช ุงูุงูุชุฑุงุถูุฉ โ

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- ูุชุญ ููุฑู ููู ุชุงุจ
- ูุง ููุฌุฏ ุชุฌููุฏ
- ุงูุจูุงูุงุช ุชุธูุฑ ุจุดูู ุตุญูุญ

## ๐ ููุงุญุธุงุช

1. **ุงูุฃุฏุงุก:** ุชุญุณู ูุจูุฑ ูู ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ
2. **ุงูุฐุงูุฑุฉ:** ูุง ูุชู ุชุญููู ุจูุงูุงุช ุบูุฑ ูุณุชุฎุฏูุฉ
3. **ุงูุดุจูุฉ:** ูุง ุงูุชุธุงุฑ ุบูุฑ ุถุฑูุฑู ููุงุชุตุงู
4. **ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู:** ุณูุณุฉ ูุณุฑูุนุฉ

## โจ ุชูุตูุงุช ูุณุชูุจููุฉ

1. ุชุทุจูู ููุณ ุงูููุท (Lazy Loading) ุนูู ุจุงูู ุงูุชุงุจุงุช
2. ุงุณุชุฎุฏุงู QThreads ููุนูููุงุช ุงูุซูููุฉ
3. ุฅุถุงูุฉ ูุคุดุฑ ุชุญููู (Loading Indicator) ููุนูููุงุช ุงูุทูููุฉ
4. ุชุญุณูู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู Indexes

---
**ุชู ุงูุฅุตูุงุญ ุจูุงุณุทุฉ:** Kiro AI  
**ุงูุญุงูุฉ:** โ ููุชูู ููุฎุชุจุฑ
