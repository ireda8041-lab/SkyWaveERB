<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فاتورة Sky Wave</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-blue: #2454a5;
            --primary-green: #00a876;
            --light-bg: #f8faff;
            --text-color: #333;
            --border-radius: 12px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #e0e0e0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        
        .invoice-container {
            background-color: white;
            width: 210mm;
            min-height: 297mm;
            padding: 40px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        /* --- Header --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }
        
        /* ترتيب العناصر: اللوجو يمين ورقم الفاتورة يسار */
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
            text-align: right;
        }
        
        .logo-img {
            width: 120px;
            height: auto;
        }
        
        .company-name h2 {
            font-size: 18px;
            color: #333;
            line-height: 1.4;
            font-weight: 700;
        }
        
        /* تلوين كلمة "تصميم مواقع" و "تسويق" مثل اللوجو */
        .company-name span {
            color: var(--primary-blue);
        }
        
        .invoice-id-box {
            background: white;
            padding: 10px 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
            text-align: center;
            min-width: 220px;
        }
        
        .invoice-id-box .label {
            color: #999;
            font-size: 12px;
            margin-bottom: 2px;
            font-weight: 600;
        }
        
        .invoice-id-box .number {
            color: var(--primary-blue);
            font-size: 18px;
            font-weight: 800;
            letter-spacing: 0.5px;
        }
        
        /* --- Info Cards --- */
        .info-cards {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .card {
            flex: 1;
            background-color: var(--light-bg);
            border-radius: var(--border-radius);
            padding: 20px 25px;
            position: relative;
            /* الشريط الأزرق على اليمين */
            border-right: 4px solid #4a8df8;
        }
        
        .card-title {
            color: var(--primary-blue);
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-title i {
            color: #888;
            font-size: 14px;
        }
        
        .info-row {
            display: flex;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        .info-label {
            color: #555;
            width: 80px;
            font-weight: 600;
            text-align: right;
        }
        
        .info-value {
            color: #000;
            font-weight: 700;
            flex: 1;
            text-align: right;
        }
        
        /* --- Tables --- */
        .section-title {
            color: var(--primary-blue);
            font-size: 16px;
            font-weight: 800;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-right: 3px solid var(--primary-blue);
            padding-right: 10px;
            height: 20px;
        }
        
        .section-title i {
            color: #777;
            font-size: 14px;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 5px;
            margin-bottom: 25px;
        }
        
        th {
            color: white;
            padding: 10px 15px;
            text-align: right;
            font-weight: 600;
            font-size: 13px;
            border: none;
        }
        
        th:first-child {
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
        }
        
        th:last-child {
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
        }
        
        .service-table th {
            background-color: var(--primary-blue);
        }
        
        .payment-table th {
            background-color: var(--primary-green);
        }
        
        td {
            padding: 12px 15px;
            background-color: white;
            font-size: 13px;
            font-weight: 700;
            color: #333;
            border-top: 1px solid #f0f0f0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        /* حدود دائرية للصفوف */
        .data-row td:first-child {
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
            border-right: 1px solid #f0f0f0;
        }
        
        .data-row td:last-child {
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
            border-left: 1px solid #f0f0f0;
        }
        
        .data-row td {
            box-shadow: 0 1px 3px rgba(0,0,0,0.02);
        }
        
        /* --- Totals --- */
        .totals-container {
            width: 40%;
            margin-right: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            font-size: 14px;
        }
        
        .total-row:not(:last-child) {
            border-bottom: 1px solid #eee;
        }
        
        .bg-white {
            background-color: #fff;
        }
        
        .bg-light-green {
            background-color: #e8fbf3;
            color: var(--primary-green);
        }
        
        .bg-blue {
            background-color: var(--primary-blue);
            color: white;
        }
        
        .total-label {
            font-weight: 700;
        }
        
        .total-value {
            font-weight: 700;
        }
        
        /* --- Footer --- */
        .footer {
            margin-top: auto;
            border-top: 2px solid var(--primary-blue);
            padding-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: var(--primary-blue);
            font-weight: 700;
        }
        
        /* الجزء اليمين في الفوتر (بيانات الاتصال) */
        .footer-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .footer-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .footer-item i {
            font-size: 12px;
        }
        
        /* الجزء اليسار في الفوتر (كلمة شكر) */
        .footer-left {
            font-size: 12px;
        }
        
        /* تحسينات الطباعة */
        @media print {
            body {
                background-color: white;
                padding: 0;
            }
            .invoice-container {
                box-shadow: none;
                width: 100%;
                height: 100%;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <div class="header">
            <div class="logo-section">
                {% if logo_path and logo_path.startswith('data:image') %}
                <img src="{{ logo_path }}" alt="SkyWave Logo" class="logo-img">
                {% else %}
                <div style="font-size: 80px; color: var(--primary-blue);">
                    <i class="fa-brands fa-servicestack"></i>
                </div>
                {% endif %}
            </div>
            <div class="invoice-id-box">
                <div class="label">رقم الفاتورة</div>
                <div class="number">{{ invoice_number }}</div>
            </div>
        </div>
        
        <div class="info-cards">
            <div class="card">
                <div class="card-title">
                    <i class="fa-regular fa-address-card"></i> معلومات العميل
                </div>
                <div class="info-row">
                    <span class="info-label">الاسم:</span>
                    <span class="info-value">{{ client_name }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">الهاتف:</span>
                    <span class="info-value">{{ client_phone }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">العنوان:</span>
                    <span class="info-value">{{ client_address }}</span>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fa-solid fa-file-invoice"></i> تفاصيل الفاتورة
                </div>
                <div class="info-row">
                    <span class="info-label">التاريخ:</span>
                    <span class="info-value">{{ invoice_date }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">تاريخ الاستحقاق:</span>
                    <span class="info-value">{{ due_date }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">المشروع:</span>
                    <span class="info-value">{{ project_name }}</span>
                </div>
            </div>
        </div>
        
        <div class="section-title">
            <i class="fa-solid fa-cart-shopping"></i> تفاصيل الخدمات
        </div>
        <table class="service-table">
            <thead>
                <tr>
                    <th style="width: 5%;">#</th>
                    <th style="width: 45%;">الخدمة</th>
                    <th style="width: 10%;">الكمية</th>
                    <th style="width: 15%;">السعر</th>
                    <th style="width: 10%;">الخصم</th>
                    <th style="width: 15%;">الإجمالي</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr class="data-row">
                    <td>{{ loop.index }}</td>
                    <td style="color: var(--primary-blue);">{{ item.name }}</td>
                    <td>{{ item.qty }}</td>
                    <td>{{ item.price }} ج.م</td>
                    <td>{{ item.discount }}%</td>
                    <td>{{ item.total }} ج.م</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        {% if payments %}
        <div class="section-title" style="margin-top: 20px;">
            <i class="fa-solid fa-money-bill-transfer"></i> سجل الدفعات المستلمة
        </div>
        <table class="payment-table">
            <thead>
                <tr>
                    <th style="width: 5%;">#</th>
                    <th style="width: 30%;">تاريخ الدفعة</th>
                    <th style="width: 35%;">طريقة الدفع</th>
                    <th style="width: 30%;">المبلغ المدفوع</th>
                </tr>
            </thead>
            <tbody>
                {% for payment in payments %}
                <tr class="data-row">
                    <td>{{ loop.index }}</td>
                    <td>{{ payment.date }}</td>
                    <td style="color: #000000;">{{ payment.account_name }}</td>
                    <td style="color: var(--primary-green);">{{ payment.amount }} ج.م</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
        
        <div class="totals-container">
            <div class="total-row bg-white">
                <span class="total-label">الإجمالي الفرعي:</span>
                <span class="total-value" style="color: var(--primary-blue);">{{ subtotal }} ج.م</span>
            </div>
            <div class="total-row bg-white">
                <span class="total-label">الإجمالي الكلي:</span>
                <span class="total-value" style="color: var(--primary-blue);">{{ grand_total }} ج.م</span>
            </div>
            <div class="total-row bg-light-green">
                <span class="total-label">✓ المبلغ المدفوع:</span>
                <span class="total-value">{{ total_paid }} ج.م</span>
            </div>
            <div class="total-row bg-blue">
                <span class="total-label">المبلغ المتبقي:</span>
                <span class="total-value">{{ remaining_amount }} ج.م</span>
            </div>
        </div>
        
        <div class="footer">
            <div class="footer-right">
                <div class="footer-item">
                    <i class="fa-solid fa-location-dot"></i> {{ company_address }}
                </div>
                <div class="footer-item">
                    <i class="fa-solid fa-phone"></i> {{ company_phone }}
                </div>
                <div class="footer-item">
                    <i class="fa-solid fa-globe"></i> {{ company_website }}
                </div>
            </div>
            <div class="footer-left">شكراً لثقتكم</div>
        </div>
    </div>
</body>
</html>
