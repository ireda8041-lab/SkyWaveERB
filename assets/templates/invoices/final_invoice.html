<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ§ØªÙˆØ±Ø© Sky Wave</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @font-face {
            font-family: 'Cairo';
            src: url('file:///{{ font_path }}') format('truetype');
            font-weight: 100 900;
            font-style: normal;
        }
        
        :root {
            --primary-blue: #2454a5;
            --primary-green: #00a876;
            --light-bg: #f8faff;
            --text-color: #000000;
            --border-radius: 15px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #e0e0e0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        
        .invoice-container {
            background-color: white;
            width: 210mm;
            max-width: 210mm;
            padding: 25px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(247, 245, 245, 0.1);
            position: relative;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }
        
        /* --- Header --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }
        
        /* ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ±: Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙŠÙ…ÙŠÙ† ÙˆØ±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙŠØ³Ø§Ø± */
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
            text-align: right;
        }
        
        .logo-img {
            width: 175px;
            height: auto;
        }
        
        .company-name h2 {
            font-size: 21px;
            color: #333;
            line-height: 1.4;
            font-weight: 700;
        }
        
        /* ØªÙ„ÙˆÙŠÙ† ÙƒÙ„Ù…Ø© "ØªØµÙ…ÙŠÙ… Ù…ÙˆØ§Ù‚Ø¹" Ùˆ "ØªØ³ÙˆÙŠÙ‚" Ù…Ø«Ù„ Ø§Ù„Ù„ÙˆØ¬Ùˆ */
        .company-name span {
            color: var(--primary-blue);
        }
        
        .invoice-id-box {
            background: white;
            padding: 10px 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
            text-align: center;
            min-width: 220px;
        }
        
        .invoice-id-box .label {
            color: #ffffff;
            font-size: 21px;
            margin-bottom: 2px;
            font-weight: 550;
        }
        
        .invoice-id-box .number {
            color: var(--primary-blue);
            font-size: 21px;
            font-weight: 750;
            letter-spacing: 0.7px;
        }
        
        /* --- Info Cards --- */
        .info-cards {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .card {
            flex: 1;
            background-color: var(--light-bg);
            border-radius: var(--border-radius);
            padding: 20px 25px;
            position: relative;
            /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ù‚ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
            border-right: 8px solid #4988ee;
        }
        
        .card-title {
            color: var(--primary-blue);
            font-weight: 700;
            font-size: 19px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-title i {
            color: #888;
            font-size: 17px;
        }
        
        .info-row {
            display: flex;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .info-label {
            color: #555;
            width: auto;
            min-width: 120px;
            font-weight: 600;
            text-align: right;
            white-space: nowrap;
        }
        
        .info-value {
            color: #000;
            font-weight: 700;
            flex: 1;
            text-align: right;
        }
        
        /* --- Tables --- */
        .section-title {
            color: var(--primary-blue);
            font-size: 19px;
            font-weight: 800;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-right: 3px solid var(--primary-blue);
            padding-right: 10px;
            height: 20px;
        }
        
        .section-title i {
            color: #777;
            font-size: 17px;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 5px;
            margin-bottom: 25px;
        }
        
        th {
            color: white;
            padding: 10px 15px;
            text-align: right;
            font-weight: 600;
            font-size: 16px;
            border: none;
        }
        
        th:first-child {
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
        }
        
        th:last-child {
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
        }
        
        .service-table th {
            background-color: var(--primary-blue);
        }
        
        .payment-table th {
            background-color: var(--primary-green);
        }
        
        td {
            padding: 12px 15px;
            background-color: white;
            font-size: 16px;
            font-weight: 700;
            color: #333;
            border-top: 1px solid #f0f0f0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        /* Ø­Ø¯ÙˆØ¯ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù„Ù„ØµÙÙˆÙ */
        .data-row td:first-child {
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
            border-right: 1px solid #f0f0f0;
        }
        
        .data-row td:last-child {
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
            border-left: 1px solid #f0f0f0;
        }
        
        .data-row td {
            box-shadow: 0 1px 3px rgba(0,0,0,0.02);
        }
        
        /* --- Totals --- */
        .totals-container {
            width: 40%;
            margin-right: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            font-size: 17px;
        }
        
        .total-row:not(:last-child) {
            border-bottom: 1px solid #eee;
        }
        
        .bg-white {
            background-color: #fff;
        }
        
        .bg-light-green {
            background-color: #e8fbf3;
            color: var(--primary-green);
        }
        
        .bg-blue {
            background-color: var(--primary-blue);
            color: white;
        }
        
        .total-label {
            font-weight: 700;
        }
        
        .total-value {
            font-weight: 700;
        }
        
        /* --- Footer --- */
        .footer {
            margin-top: auto;
            border-top: 2px solid var(--primary-blue);
            padding-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: var(--primary-blue);
            font-weight: 700;
        }
        
        /* Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ÙŠÙ…ÙŠÙ† ÙÙŠ Ø§Ù„ÙÙˆØªØ± (Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„) */
        .footer-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .footer-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .footer-item i {
            font-size: 15px;
        }
        
        /* Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ÙŠØ³Ø§Ø± ÙÙŠ Ø§Ù„ÙÙˆØªØ± (ÙƒÙ„Ù…Ø© Ø´ÙƒØ±) */
        .footer-left {
            font-size: 15px;
        }
        
        /* âš¡ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© - A4 ÙƒØ§Ù…Ù„ */
        @media print {
            @page {
                size: A4;
                margin: 0;
            }
            
            body {
                background-color: white;
                padding: 0;
                margin: 0;
            }
            
            .invoice-container {
                box-shadow: none;
                width: 210mm !important;
                max-width: 210mm !important;
                min-height: 297mm !important;
                border-radius: 0;
                padding: 20px !important;
                page-break-inside: avoid;
            }
            
            /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ± ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ© */
            button, .no-print {
                display: none !important;
            }
            
            /* ØªØ£ÙƒÙŠØ¯ Ø¸Ù‡ÙˆØ± ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
            .section-title, table, .totals-container, .footer {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <div class="header">
            <div class="logo-section">
                {% if logo_path and logo_path.startswith('data:image') %}
                <img src="{{ logo_path }}" alt="SkyWave Logo" class="logo-img">
                {% else %}
                <div style="font-size: 80px; color: var(--primary-blue);">
                    <i class="fa-brands fa-servicestack"></i>
                </div>
                {% endif %}
            </div>
            <div class="invoice-id-box">
                <div class="label"> Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</div>
                <div class="number">{{ invoice_number }}</div>
            </div>
        </div>
        
        <div class="info-cards">
            <div class="card">
                <div class="card-title">
                     Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
                </div>
                <div class="info-row">
                    <span class="info-label"> Ø§Ù„Ø§Ø³Ù…:</span>
                    <span class="info-value">{{ client_name }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label"> Ø§Ù„Ù‡Ø§ØªÙ:</span>
                    <span class="info-value">{{ client_phone }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label"> Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span>
                    <span class="info-value">{{ client_address }}</span>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                     ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                </div>
                <div class="info-row">
                    <span class="info-label"> Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                    <span class="info-value">{{ invoice_date }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label"> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:</span>
                    <span class="info-value">{{ due_date }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label"> Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</span>
                    <span class="info-value">{{ project_name }}</span>
                </div>
            </div>
        </div>
        
        <div class="section-title">
             ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
        </div>
        <table class="service-table">
            <thead>
                <tr>
                    <th style="width: 5%;">#</th>
                    <th style="width: 45%;">Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                    <th style="width: 10%;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th style="width: 15%;">Ø§Ù„Ø³Ø¹Ø±</th>
                    <th style="width: 10%;">Ø§Ù„Ø®ØµÙ…</th>
                    <th style="width: 15%;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr class="data-row">
                    <td>{{ loop.index }}</td>
                    <td style="color: var(--primary-blue);">{{ item.name }}</td>
                    <td>{{ item.qty }}</td>
                    <td>{{ item.price }} Ø¬.Ù…</td>
                    <td>{{ item.discount }}%</td>
                    <td>{{ item.total }} Ø¬.Ù…</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        {% if payments and payments|length > 0 %}
        <div class="section-title" style="margin-top: 20px;">
             Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©
        </div>
        <table class="payment-table">
            <thead>
                <tr>
                    <th style="width: 5%;">#</th>
                    <th style="width: 30%;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹Ø©</th>
                    <th style="width: 35%;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                    <th style="width: 30%;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
                </tr>
            </thead>
            <tbody>
                {% for payment in payments %}
                <tr class="data-row">
                    <td>{{ loop.index }}</td>
                    <td>{{ payment.date if payment.date else 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</td>
                    <td style="color: #000000;">{{ payment.account_name if payment.account_name else payment.account_id }}</td>
                    <td style="color: var(--primary-green);">{{ "%.2f"|format(payment.amount|float) }} Ø¬.Ù…</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
        
        <div class="totals-container">
            <div class="total-row bg-white">
                <span class="total-label"> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                <span class="total-value" style="color: var(--primary-blue);">{{ "%.2f"|format(subtotal|float) }} Ø¬.Ù…</span>
            </div>
            <div class="total-row bg-white">
                <span class="total-label"> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ:</span>
                <span class="total-value" style="color: var(--primary-blue);">{{ "%.2f"|format(grand_total|float) }} Ø¬.Ù…</span>
            </div>
            <div class="total-row bg-light-green">
                <span class="total-label"> Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</span>
                <span class="total-value">{{ "%.2f"|format(total_paid|float) }} Ø¬.Ù…</span>
            </div>
            <div class="total-row bg-blue">
                <span class="total-label"> Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</span>
                <span class="total-value">{{ "%.2f"|format(remaining_amount|float) }} Ø¬.Ù…</span>
            </div>
        </div>
        
        <div class="footer">
            <div class="footer-right">
                <div class="footer-item">
                    ğŸ“ {{ company_address }}
                </div>
                <div class="footer-item">
                    ğŸ“ {{ company_phone }}
                </div>
                <div class="footer-item">
                    ğŸŒ {{ company_website }}
                </div>
            </div>
            <div class="footer-left">â¤ï¸ Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒÙ…</div>
        </div>
    </div>
</body>
</html>
